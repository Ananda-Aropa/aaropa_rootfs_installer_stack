name: Generate builder image

on:
  workflow_dispatch:

env:
  REF: ${{ github.ref }}
  AUTHOR: ${{ secrets.RELEASE_USERNAME }}
  PAT: ${{ secrets.RELEASE_TOKEN }}

jobs:
  build-and-publish-image:
    strategy:
      matrix:
        os: [ubuntu-latest]

    runs-on: ${{ matrix.os }}

    steps:
      - name: Trigger Workflow for BlissOS Installer
        uses: convictional/trigger-workflow-and-wait@v1.6.5
        with:
          owner: Ananda-Aropa
          repo: aaropa_rootfs_installer_blissos
          github_token: ${{ env.PAT }}
          github_user: ${{ env.AUTHOR }}
          workflow_file_name: build_rootfs.yml
          ref: main
          trigger_workflow: true
          wait_workflow: false

      - name: Trigger Workflow for BassOS Installer
        uses: convictional/trigger-workflow-and-wait@v1.6.5
        with:
          owner: Ananda-Aropa
          repo: aaropa_rootfs_installer_bassos
          github_token: ${{ env.PAT }}
          github_user: ${{ env.AUTHOR }}
          workflow_file_name: build_rootfs.yml
          ref: main
          trigger_workflow: true
          wait_workflow: false

      - name: Trigger Workflow for LineageOS Installer
        uses: convictional/trigger-workflow-and-wait@v1.6.5
        with:
          owner: Ananda-Aropa
          repo: aaropa_rootfs_installer_lineageos
          github_token: ${{ env.PAT }}
          github_user: ${{ env.AUTHOR }}
          workflow_file_name: build_rootfs.yml
          ref: main
          trigger_workflow: true
          wait_workflow: false